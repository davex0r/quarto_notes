<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Jordan">
<meta name="author" content="Somsubhro Bagchi">
<meta name="dcterms.date" content="2025-09-09">

<title>Second Generation Bioreactor Build Note – Notebooks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-d166b450ba5a8e9f7a0ab969bf6592c1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-22381ab97ffb8a420d3841344730e94d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Notebooks</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Notes Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tech.html"> 
<span class="menu-text">Technical Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../builds.html"> 
<span class="menu-text">Build Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../concepts.html"> 
<span class="menu-text">Concept Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://livingphysics.org"> <i class="bi bi-globe" role="img">
</i> 
<span class="menu-text">Main Site</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text">RSS Feed</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Second Generation Bioreactor Build Note</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Builds</div>
                <div class="quarto-category">Bioreactor</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-contents">
               <p><a href="mailto:public@livingphysics.org">David Jordan</a> </p>
               <p><a href="mailto:som@livingphysics.org">Somsubhro Bagchi</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 9, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#design-and-construction" id="toc-design-and-construction" class="nav-link" data-scroll-target="#design-and-construction">Design and Construction</a>
  <ul class="collapse">
  <li><a href="#temp_system" id="toc-temp_system" class="nav-link" data-scroll-target="#temp_system">Temperature System</a></li>
  <li><a href="#pumps" id="toc-pumps" class="nav-link" data-scroll-target="#pumps">Pump System</a></li>
  <li><a href="#od_system" id="toc-od_system" class="nav-link" data-scroll-target="#od_system">Optical Density System</a></li>
  <li><a href="#stirring-and-illumination" id="toc-stirring-and-illumination" class="nav-link" data-scroll-target="#stirring-and-illumination">Stirring and Illumination</a></li>
  </ul></li>
  <li><a href="#control_software" id="toc-control_software" class="nav-link" data-scroll-target="#control_software">Control and Software</a>
  <ul class="collapse">
  <li><a href="#codebase" id="toc-codebase" class="nav-link" data-scroll-target="#codebase">Codebase</a></li>
  <li><a href="#chemostat_mode" id="toc-chemostat_mode" class="nav-link" data-scroll-target="#chemostat_mode">Chemostat Mode</a></li>
  <li><a href="#turbidostat_mode" id="toc-turbidostat_mode" class="nav-link" data-scroll-target="#turbidostat_mode">Turbidostat Mode</a></li>
  </ul></li>
  <li><a href="#calibration" id="toc-calibration" class="nav-link" data-scroll-target="#calibration">Calibration and Testing</a>
  <ul class="collapse">
  <li><a href="#temperature-control" id="toc-temperature-control" class="nav-link" data-scroll-target="#temperature-control">Temperature Control</a></li>
  <li><a href="#pump_calibration" id="toc-pump_calibration" class="nav-link" data-scroll-target="#pump_calibration">Pump Calibration</a></li>
  <li><a href="#temp_calibration" id="toc-temp_calibration" class="nav-link" data-scroll-target="#temp_calibration">Temperature Controller</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="overview" class="level1">
<h1>Overview</h1>
<p>This note outlines the build of our second generation bioreactor. This version of the bioreactor includes <a href="#temp_system">Temperature Control</a> and a <a href="#pumps">Pump System</a> for exchanging media. It can be run as a batch reaction with the pumps tuned off, or as a <a href="#turbidostat_mode">Turbidostat</a> or a <a href="#chemostat_mode">Chemostat</a>. This is not a sealed system as in <a href="../../build_posts/gen1_reactor_build/index.html">Bioreactor_v1</a> so there are no pressure measurements for this system.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The second generation bioreactor was designed to enable continuous culturing of microbes. Continuous culture refers to growth with very frequent small dilutions and removal of old media and cells. This is in contrast to “batch culture” where a liquid broth is grown from a small number of cells to a high density, and then diluted all at once, usually by transferring a small volume of the dense culture to another large volume of fresh media. There are different ways in which continuous cultures are realized. The main challenge is setting the dilution rate such that the culture is always growing exponentially, without getting diluted to extinction or growing too dense for the measurement device. This is can be done in a variety of ways, but two common methods are <a href="#chemostat_mode">chemostat</a> operation and <a href="#turbidostat_mode">turbidostat</a> operation. Conceptually, the turbidostat is easiest to understand. In this mode, there is direct feedback from a cultures optical density to the dilution. One simple tragedy is to activate dilution when the OD is above a set-point until OD is brought to the set-point. Another strategy is to adjust the dilution rate in proportion to the difference from the setpoint with a feedback controller, such as a proportional integral differential (PID) controller. Another method we have implemented is based on state space prediction using a Kalman filter, which dilutes below the set point and allows the culture to regrow up to the setpoint in order to provide more accurate estimates of the growth rate<span class="citation" data-cites="Hoffmann2017-po">&nbsp;[<a href="#ref-Hoffmann2017-po" role="doc-biblioref">1</a>]</span>. The chemostat was originally introduced b Novick and Szilard in 1950<span class="citation" data-cites="Novick1950-fv">&nbsp;[<a href="#ref-Novick1950-fv" role="doc-biblioref">2</a>]</span>. A chemostat uses a liquid medium that has a single limiting nutrient that controls te growth rate, which is then set by the dilution rate <span class="math inline">\(D\)</span> where the doubling time <span class="math inline">\(t_d\)</span> is given by <span class="math display">\[ \large t_d = \frac{ln 2}{D}\]</span><br>
The chemostat is designed so that the parameters of the culture (like growth rate, optical density, cell number, pH, etc) remain constant.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Bioreactor_v2.jpeg" class="img-fluid figure-img"></p>
<figcaption>Bioreactor v2</figcaption>
</figure>
</div>
</section>
<section id="design-and-construction" class="level1">
<h1>Design and Construction</h1>
<section id="temp_system" class="level2">
<h2 class="anchored" data-anchor-id="temp_system">Temperature System</h2>
<p>The temperature control system is based on a PC water-cooling system. In short, heated or cooled water is pumped around a closed loop which includes a sleeve that bathes the bottom of the vial. The pump is a <a href="https://www.amazon.co.uk/Cooling-3000RPM-Integrated-Support-Intelligent-default/dp/B08CZW82T6">PC liquid cooling pump</a>. This pumps water into an <a href="https://www.amazon.co.uk/dp/B09B36Q5T3">aluminum heat exchanger</a> which has been attached to a <a href="https://www.amazon.co.uk/dp/B08FBRY2BN">Peltier effect element</a> with <a href="https://www.amazon.co.uk/dp/B0BN3R5717">thermally conductive double stick tape</a>. The opposite side of peltier element is attached to a <a href="https://uk.rs-online.com/web/p/heatsinks/0158556">heat-sink and fan assembly</a>. There are 2 <a href="https://www.amazon.co.uk/dp/B08GJ72CC3">inline thermistors</a> to measure the water temperature just after the and at the end of the loop jut before the pump. The vials are sheathed in <a href="https://www.amazon.co.uk/dp/B07MG4FKLB">motor water cooling jackets</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/cooling_jacket.jpeg" class="img-fluid figure-img"></p>
<figcaption>Motor cooling jacket repurposed as vial water bath</figcaption>
</figure>
</div>
<p>Originally this was designed to distribute the flow in parallel, but pressure differential issues resulted in uneven flows tot eh four reactors, so instead they are run in series. This means that heat loss results in a gradient of temperatures from vial A (nearest to outflow) to vial D (farthest from outflow), but ths gradient is measured and recorded. The current provided to the Peltier element is controlled by a <a href="https://uk.robotshop.com/products/cytron-20a-6-30v-single-dc-motor-controller">Cytron MD20A</a> motor controller via a PWM signal from the Raspberry Pi. The current passing through the peltier element is recorded by an <a href="https://thepihut.com/products/adafruit-ina219-high-side-dc-current-sensor-breakout-26v-3-2a-max">INA219</a> chip via I2C with Qwiic connectors. The inline flow temperatures are converted to voltages using a simple 10kOhm voltage divider circuit an read into the Pi via one of the free ADC ports on one of the 2 <a href="https://thepihut.com/products/adafruit-ads7830-8-channel-8-bit-adc-with-i2c-stemma-qt-qwiic">ADS7830</a> analog to digital converters.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Bioreactor_v2_2025-Sep-12_01-46-52PM-000_CustomizedView28749035375.png" class="img-fluid figure-img"></p>
<figcaption>Schematic of the PC Water-cooling based temperature controller</figcaption>
</figure>
</div>
</section>
<section id="pumps" class="level2">
<h2 class="anchored" data-anchor-id="pumps">Pump System</h2>
<p>The pump system consists of 8 <a href="https://www.amazon.co.uk/dp/B07RWNZDCR">stepper motor controlled peristaltic pumps</a>, a fresh media feed pump and a waste removal pump for each of the 4 bioreactor vials. The pumps are powered by a dedicated <a href="https://www.amazon.co.uk/dp/B0CGR54L81">6A power supply</a> and connected through a <a href="https://thepihut.com/products/10-port-usb-hub-5v-4a">USB hub</a> to <a href="https://www.pololu.com/product/3130">Pololu Tic</a> stepper motor controllers. The pumps are connected by luer lock adapters to stainless steel syringe needles in custom <a href="https://labcrafter.co.uk/products/40ml-glass-vial-cap-s-with-ports-and-stir-bar">3D printed caps</a>. Pumps are connected to media feed bottle using these <a href="https://pioreactor.com/collections/accessories-and-parts/products/gl45-cap-with-luer-lock-connectors?variant=46788561403960">custom printed lids</a> with the 14 inch tubing option.</p>
</section>
<section id="od_system" class="level2">
<h2 class="anchored" data-anchor-id="od_system">Optical Density System</h2>
<p>We used the design from 3D printed LED holder we developed for the <a href="../../build_posts/gen1_reactor_update_01/index.html">updated Bioreactor v1</a>, as well as the same <a href="../../build_posts/gen1_reactor_update_01/index.html#amplifier">transimpedance amplifier circuit</a>. This comprises 12 voltage measurements that are read into 12/16 ports of a pair of ADS7830 ADCs. The 3D printed LED holder sleeve is shown in black in the schematic diagram.</p>
</section>
<section id="stirring-and-illumination" class="level2">
<h2 class="anchored" data-anchor-id="stirring-and-illumination">Stirring and Illumination</h2>
<p>The stirring and illumination system is also copied form our <a href="../../build_posts/gen1_reactor_build/index.html">v1 Bioreactor design</a>, using PC fans with attached magnets and 8 element Neopixel ring lights for programmable RGB illumination from below.</p>
</section>
</section>
<section id="control_software" class="level1">
<h1>Control and Software</h1>
<section id="codebase" class="level2">
<h2 class="anchored" data-anchor-id="codebase">Codebase</h2>
<p>The full BioreactorV2 codebase can e found in <a href="https://github.com/livingphysics/Bioreactor_v2">here</a>. Data from experiments is written into the bioreactor_data directory and pushed as commits. The code creates a <code>Bioreactor</code> class to manage all sensors and operations for the bioreactor. The class initializes the ADCs, the infrared LEDs, the stirrers, the ring lights, the temperature sensors, the peltier controller, the peltier current monitor, the pumps and a set of relays on startup. A new datafile is initialized with the current date and time and stored int he bioreactor_data directory. Threading is used to start separate jobs that may have different update cycles, for example, the PID temperature control might update every second, while the sensor measurements may update every 5 seconds, and the pumps every 60 seconds. This is controlled by creating and starting jobs, see <a href="https://github.com/livingphysics/Bioreactor_v2/blob/main/example_scripts/new_chemostat.py">new_chemostat</a> for an example.</p>
</section>
<section id="chemostat_mode" class="level2">
<h2 class="anchored" data-anchor-id="chemostat_mode">Chemostat Mode</h2>
<p>Chemostat operation relies on matched inflow and outflow to ensure that the culture volume does not drift overtime. Despite extensive <a href="#pump_calibration">calibration</a> efforts, the pump tolerances were not sufficient to maintain volumes over the extended run times. In order to overcome this, outflow ports were placed at a fixed height so that liquid levels could not fall below this line. In addition, outflow was set to 1.1x the inflow rate. In the codebase, the <code>compensate_flow</code> method carries out this program. The <code>balanced_flow</code> method is retained in the case that a more accurate pump system is designed in future. Another option would be to included a serially connected scale for each bioreactor and feedback the flow levels on the actual vial mass.</p>
</section>
<section id="turbidostat_mode" class="level2">
<h2 class="anchored" data-anchor-id="turbidostat_mode">Turbidostat Mode</h2>
<p>We implemented a turbidostat mode based on the Extended Kalman filter design of Holffmann and colleagues<span class="citation" data-cites="Hoffmann2017-po">&nbsp;[<a href="#ref-Hoffmann2017-po" role="doc-biblioref">1</a>]</span>. Thius works by online estimation of a hidden state space of the culture which contains both estimates of its current OD and its growth rate. * <strong>State variables</strong>: The EKF tracks two hidden states:</p>
<ol type="1">
<li><strong>Optical density (OD)</strong> of the culture.</li>
<li><strong>Growth rate (r)</strong>, expressed as a geometric growth factor per time step.</li>
</ol>
<ul>
<li><p><strong>Dynamic model</strong>: They assume discrete exponential growth between measurements: [ OD_{k+1} = OD_k r_k] and [ r_{k+1} = r_k,] meaning OD changes multiplicatively with growth, while the growth rate is treated as constant between steps but can be updated when new information arrives.</p></li>
<li><p><strong>Recursive estimation</strong>: At every second, the EKF predicts the next OD and growth rate, then updates those predictions using the noisy optical density measurement. The Kalman gain balances trust between the model prediction and new data, depending on their variances.</p></li>
<li><p><strong>Dilution events</strong>: Since pump events cause sudden drops in OD, the filter assigns a <strong>high uncertainty to OD estimates</strong> during and immediately after dilution. This lets the OD quickly reconverge to the true density, while the growth rate estimate remains stable because its covariance is not reset. As a result, growth rate estimates survive dilution disturbances and retain continuity.</p></li>
</ul>
<p>The code assciated with the implemenation of this mode can be found in the turbidostat_od_controller method and ExtendedKalmanFilter object method in src/utils in <a href="https://github.com/livingphysics/Bioreactor_v2/blob/main/src/utils.py">Bioreactor_v2</a>.</p>
</section>
</section>
<section id="calibration" class="level1">
<h1>Calibration and Testing</h1>
<section id="temperature-control" class="level2">
<h2 class="anchored" data-anchor-id="temperature-control">Temperature Control</h2>
<p>Tempoerature control data can be pulled directly from the GitHub repository and plotted in-line with Quarto and Python. Here we show the temperature difference</p>
<div id="743fe7cd" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If file is local (after downloading from GitHub)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># df = pd.read_csv("20250901_131355_bioreactor_data.csv")</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Or load directly from GitHub raw link (requires internet access)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> (<span class="st">"https://raw.githubusercontent.com/livingphysics/Bioreactor_v2/refs/heads/main/bioreactor_data/20250901_131355_bioreactor_data.csv"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.iloc[<span class="dv">2000</span>:]</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute difference</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'temp_diff'</span>] <span class="op">=</span> df[<span class="st">'vial_D_temp'</span>] <span class="op">-</span> <span class="dv">27</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> df[<span class="st">'vial_D_temp'</span>] <span class="op">-</span> <span class="dv">27</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.dropna()</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>std_dev <span class="op">=</span> data.std()</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>plt.hist(df[<span class="st">'temp_diff'</span>].dropna(), bins<span class="op">=</span><span class="dv">12</span>, density<span class="op">=</span><span class="va">True</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'vial_D_temp − set_point(27) (°C)'</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Probability Density'</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Histogram of Temperature Deviation</span><span class="ch">\n</span><span class="ss">Std Dev = </span><span class="sc">{</span>std_dev<span class="sc">:.3f}</span><span class="ss"> °C'</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-2-output-1.png" width="651" height="467" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pump_calibration" class="level2">
<h2 class="anchored" data-anchor-id="pump_calibration">Pump Calibration</h2>
<p>Pump calibration was carried out by measuring flow rates using an RS232 connected digital scale from <a href="https://uk.rs-online.com/web/p/weighing-scales/2753858?gb=s">Kern</a> with a 0.001g resolution. Data was read using the pyserial function in Python. Calibration is done by running each pump at a defined step rate for a fixed time, weighing the water before and after with the connected scale, and converting the change in mass (grams) to volume. The software repeats this several times, records the step rate, run duration, and measured flow rate (ml/s) into a CSV file, and then uses linear regression and plotting utilities to build a calibration curve that maps step rates to actual flow rates for each pump and direction.</p>
</section>
<section id="temp_calibration" class="level2">




</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Temperature Controller</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-Hoffmann2017-po" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">S. A. Hoffmann, C. Wohltat, K. M. Müller, and K. M. Arndt, <em>A User-Friendly, Low-Cost Turbidostat with Versatile Growth Rate Estimation Based on an Extended Kalman Filter</em>, PLoS One <strong>12</strong>, e0181923 (2017).</div>
</div>
<div id="ref-Novick1950-fv" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">A. Novick and L. Szilard, <em>Description of the Chemostat</em>, Science <strong>112</strong>, 715 (1950).</div>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/notes\.livingphysics\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>